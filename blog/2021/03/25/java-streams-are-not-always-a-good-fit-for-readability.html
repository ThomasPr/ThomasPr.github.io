<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.24.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Java Streams are not always a good fit for readability - Thomas’ Blog</title>
<meta name="description" content="Java Streams are powerful but need to get special attention to keep the implementation readable.">


  <meta name="author" content="Thomas Preißler">
  
  <meta property="article:author" content="Thomas Preißler">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Thomas' Blog">
<meta property="og:title" content="Java Streams are not always a good fit for readability">
<meta property="og:url" content="https://thomas.preissler.me/blog/2021/03/25/java-streams-are-not-always-a-good-fit-for-readability">


  <meta property="og:description" content="Java Streams are powerful but need to get special attention to keep the implementation readable.">



  <meta property="og:image" content="https://thomas.preissler.me/assets/images/2021-03-25/streams.png">





  <meta property="article:published_time" content="2021-03-25T22:03:03+00:00">






<link rel="canonical" href="https://thomas.preissler.me/blog/2021/03/25/java-streams-are-not-always-a-good-fit-for-readability">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Thomas Preißler",
      "url": "https://thomas.preissler.me/",
      "sameAs": ["https://twitter.com/TheThomasPr","https://github.com/ThomasPr","https://stackoverflow.com/users/915955/thomas-prei%c3%9fler","https://www.xing.com/profile/Thomas_Preissler","https://www.linkedin.com/in/thomas-preissler/"]
    
  }
</script>


  <meta name="google-site-verification" content="VhaciMaca92rdlXRrqBBFXCR1hxERcyhW4Kqq7XafWM" />






<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Thomas' Blog Feed">


<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"></noscript>



    <link rel="icon" href="/assets/images/thomas.jpg" type="image/jpeg" />

  </head>

  <body class="layout--single wide">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          Thomas' Blog
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/">Blog</a>
            </li><li class="masthead__menu-item">
              <a href="/about">About</a>
            </li></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      
        <img src="/assets/images/thomas.jpg" alt="Thomas Preißler" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Thomas Preißler</h3>
    
    
      <div class="author__bio" itemprop="description">
        <p>software developer,<br />addicted to KISS</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Freiburg, Germany</span>
        </li>
      

      
        
          
            <li><a href="mailto:thomas@preissler.me" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-envelope" aria-hidden="true"></i><span class="label">Email</span></a></li>
          
        
          
            <li><a href="https://twitter.com/TheThomasPr" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span class="label">Twitter</span></a></li>
          
        
          
            <li><a href="https://github.com/ThomasPr" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span></a></li>
          
        
          
            <li><a href="https://stackoverflow.com/users/915955/thomas-prei%c3%9fler" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-stack-overflow" aria-hidden="true"></i><span class="label">Stack Overflow</span></a></li>
          
        
          
            <li><a href="https://www.xing.com/profile/Thomas_Preissler" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-xing" aria-hidden="true"></i><span class="label">Xing</span></a></li>
          
        
          
            <li><a href="https://www.linkedin.com/in/thomas-preissler" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span class="label">LinkedIn</span></a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Java Streams are not always a good fit for readability">
    <meta itemprop="description" content="Java Streams are powerful but need to get special attention to keep the implementation readable.">
    <meta itemprop="datePublished" content="2021-03-25T22:03:03+00:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Java Streams are not always a good fit for readability
</h1>
          


        </header>
      

      <section class="page__content" itemprop="text">
        
        <p>I really like functional programming, it offers powerful expressions with only a few lines of code. When Streams have been introduced in Java 8, they where a huge improvement for someone like me who got used to ruby and its functional power for quite some time.</p>

<p>Even if Java Streams are a good choice for many problems, they might be not the best choice for readability. I want to show you an example where I struggeled for a good solution. Java Streams sound like the perfect solution for that kind of problem.</p>

<p>But let’s get started:</p>

<h2 id="the-problem">The problem</h2>

<p>I cannot give any details about the actual business requirement about that. But I hopefully got a really neat story instead.</p>

<p>I want to get a list of all people and their pets and the possibiliets they can go for a walk. Each person wants to walk with all of their pets in all possible combinations. But it is not allowed two walk two pets of the same kind at the same time.</p>

<p>Example: Thomas has two dogs, two cats and a pig. The result shold be:</p>

<table>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">Thomas</code></td>
      <td><code class="language-plaintext highlighter-rouge">Dog 1</code></td>
      <td><code class="language-plaintext highlighter-rouge">Cat 1</code></td>
      <td><code class="language-plaintext highlighter-rouge">Pig</code></td>
      <td> </td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">Thomas</code></td>
      <td><code class="language-plaintext highlighter-rouge">Dog 2</code></td>
      <td><code class="language-plaintext highlighter-rouge">Cat 1</code></td>
      <td><code class="language-plaintext highlighter-rouge">Pig</code></td>
      <td> </td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">Thomas</code></td>
      <td><code class="language-plaintext highlighter-rouge">Dog 1</code></td>
      <td><code class="language-plaintext highlighter-rouge">Cat 2</code></td>
      <td><code class="language-plaintext highlighter-rouge">Pig</code></td>
      <td> </td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">Thomas</code></td>
      <td><code class="language-plaintext highlighter-rouge">Dog 2</code></td>
      <td><code class="language-plaintext highlighter-rouge">Cat 2</code></td>
      <td><code class="language-plaintext highlighter-rouge">Pig</code></td>
      <td> </td>
    </tr>
  </tbody>
</table>

<p>Keep in mind that even if Thomas would have no cat, he wants wo walk his dogs and his pig.</p>

<table>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">Thomas</code></td>
      <td><code class="language-plaintext highlighter-rouge">Dog 1</code></td>
      <td> </td>
      <td><code class="language-plaintext highlighter-rouge">Pig</code></td>
      <td> </td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">Thomas</code></td>
      <td><code class="language-plaintext highlighter-rouge">Dog 2</code></td>
      <td> </td>
      <td><code class="language-plaintext highlighter-rouge">Pig</code></td>
      <td> </td>
    </tr>
  </tbody>
</table>

<h2 id="start-with-some-coding">Start with some coding</h2>

<p>The people and animals are fetched from independent external sources and could look like that:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">people</span> <span class="o">=</span> <span class="n">getPeopleInTown</span><span class="o">(</span><span class="s">"Freiburg"</span><span class="o">);</span>

<span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Cat</span><span class="o">&gt;&gt;</span> <span class="o">=</span> <span class="n">getCatsForPeople</span><span class="o">(</span><span class="n">people</span><span class="o">);</span>
<span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Dog</span><span class="o">&gt;&gt;</span> <span class="o">=</span> <span class="n">getDogsForPeople</span><span class="o">(</span><span class="n">people</span><span class="o">);</span>
<span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Pig</span><span class="o">&gt;&gt;</span> <span class="o">=</span> <span class="n">getPigsForPeople</span><span class="o">(</span><span class="n">people</span><span class="o">);</span>
</code></pre></div></div>

<p>To model a <code class="language-plaintext highlighter-rouge">Walk</code> the simple Java class will be used:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Walk</span> <span class="o">{</span>

	<span class="nc">String</span> <span class="n">person</span><span class="o">;</span>
	<span class="nc">Cat</span> <span class="n">cat</span><span class="o">;</span>
	<span class="nc">Dog</span> <span class="n">dog</span><span class="o">;</span>
	<span class="nc">Pig</span> <span class="n">pig</span><span class="o">;</span>

	<span class="kd">public</span> <span class="nf">Walk</span><span class="o">(</span><span class="nc">String</span> <span class="n">person</span><span class="o">,</span> <span class="nc">Cat</span> <span class="n">cat</span><span class="o">,</span> <span class="nc">Dog</span> <span class="n">dog</span><span class="o">,</span> <span class="nc">Pig</span> <span class="n">pig</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">person</span> <span class="o">=</span> <span class="n">person</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">cat</span> <span class="o">=</span> <span class="n">cat</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">dog</span> <span class="o">=</span> <span class="n">dog</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">pig</span> <span class="o">=</span> <span class="n">pig</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="c1">// getters and setters omitted for brevity</span>
<span class="o">}</span>
</code></pre></div></div>

<p>To build the walk, we introduce a <code class="language-plaintext highlighter-rouge">buildWalks</code> method.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Walk</span><span class="o">&gt;</span> <span class="nf">buildWalks</span><span class="o">(</span>
    <span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">people</span><span class="o">,</span>
    <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Cat</span><span class="o">&gt;&gt;</span> <span class="n">cats</span><span class="o">,</span>
    <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Dog</span><span class="o">&gt;&gt;</span> <span class="n">dogs</span><span class="o">,</span>
    <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Pig</span><span class="o">&gt;&gt;</span> <span class="n">pigs</span><span class="o">)</span> <span class="o">{</span>

  <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Walk</span><span class="o">&gt;</span> <span class="n">walks</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>

  <span class="c1">// do the magic</span>

  <span class="k">return</span> <span class="n">walks</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<h2 id="the-naive-implementation">The naive implementation</h2>

<p>My first appraoch was to use just a couple of <code class="language-plaintext highlighter-rouge">for</code>-loops. It looks gorgeous and is easy to read.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Walk</span><span class="o">&gt;</span> <span class="nf">buildWalks</span><span class="o">(</span>
    <span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">people</span><span class="o">,</span>
    <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Cat</span><span class="o">&gt;&gt;</span> <span class="n">cats</span><span class="o">,</span>
    <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Dog</span><span class="o">&gt;&gt;</span> <span class="n">dogs</span><span class="o">,</span>
    <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Pig</span><span class="o">&gt;&gt;</span> <span class="n">pigs</span><span class="o">)</span> <span class="o">{</span>

  <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Walk</span><span class="o">&gt;</span> <span class="n">walks</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>

  <span class="k">for</span><span class="o">(</span><span class="nc">String</span> <span class="n">person</span> <span class="o">:</span> <span class="n">people</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">for</span> <span class="o">(</span><span class="nc">Cat</span> <span class="n">cat</span> <span class="o">:</span> <span class="n">cats</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">person</span><span class="o">))</span> <span class="o">{</span>
      <span class="k">for</span> <span class="o">(</span><span class="nc">Dog</span> <span class="n">dog</span> <span class="o">:</span> <span class="n">dogs</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">person</span><span class="o">))</span> <span class="o">{</span>
        <span class="k">for</span> <span class="o">(</span><span class="nc">Pig</span> <span class="n">pig</span> <span class="o">:</span> <span class="n">pigs</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">person</span><span class="o">))</span> <span class="o">{</span>
          <span class="n">walks</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="nc">Walk</span><span class="o">(</span><span class="n">person</span><span class="o">,</span> <span class="n">cat</span><span class="o">,</span> <span class="n">dog</span><span class="o">,</span> <span class="n">pig</span><span class="o">));</span>
        <span class="o">}</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>

  <span class="k">return</span> <span class="n">walks</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Unfortunately, it doesn’t work. If Thomas has no cat, he won’t be able to do any walk. That’s bad for his other pets.</p>

<p>If the list of cats is empty, the <code class="language-plaintext highlighter-rouge">for</code>-loop will not be executed and therefore the <code class="language-plaintext highlighter-rouge">walks.add()</code>-method will never be called.</p>

<p>Ok, let’s fix it. We need to make sure that every <code class="language-plaintext highlighter-rouge">for</code>-loop will be executed at least once:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Walk</span><span class="o">&gt;</span> <span class="nf">buildWalks</span><span class="o">(</span>
    <span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">people</span><span class="o">,</span>
    <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Cat</span><span class="o">&gt;&gt;</span> <span class="n">cats</span><span class="o">,</span>
    <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Dog</span><span class="o">&gt;&gt;</span> <span class="n">dogs</span><span class="o">,</span>
    <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Pig</span><span class="o">&gt;&gt;</span> <span class="n">pigs</span><span class="o">)</span> <span class="o">{</span>

  <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Walk</span><span class="o">&gt;</span> <span class="n">walks</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>

  <span class="k">for</span><span class="o">(</span><span class="nc">String</span> <span class="n">person</span> <span class="o">:</span> <span class="n">people</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">for</span> <span class="o">(</span><span class="nc">Cat</span> <span class="n">cat</span> <span class="o">:</span> <span class="n">atLeastOnce</span><span class="o">(</span><span class="n">cats</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">person</span><span class="o">)))</span> <span class="o">{</span>
      <span class="k">for</span> <span class="o">(</span><span class="nc">Dog</span> <span class="n">dog</span> <span class="o">:</span> <span class="n">atLeastOnce</span><span class="o">(</span><span class="n">dogs</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">person</span><span class="o">)))</span> <span class="o">{</span>
        <span class="k">for</span> <span class="o">(</span><span class="nc">Pig</span> <span class="n">pig</span> <span class="o">:</span> <span class="n">atLeastOnce</span><span class="o">(</span><span class="n">pigs</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">person</span><span class="o">)))</span> <span class="o">{</span>
          <span class="n">walks</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="nc">Walk</span><span class="o">(</span><span class="n">person</span><span class="o">,</span> <span class="n">cat</span><span class="o">,</span> <span class="n">dog</span><span class="o">,</span> <span class="n">pig</span><span class="o">));</span>
        <span class="o">}</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>

  <span class="k">return</span> <span class="n">walks</span><span class="o">;</span>
<span class="o">}</span>

<span class="kd">private</span> <span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="nc">List</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="nf">atLeastOnce</span><span class="o">(</span><span class="nc">List</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">animals</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">animals</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">animals</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
    <span class="k">return</span> <span class="nf">getNulledList</span><span class="o">();</span>
  <span class="o">}</span>
  <span class="k">return</span> <span class="n">animals</span><span class="o">;</span>
<span class="o">}</span>

<span class="kd">private</span> <span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="nc">List</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="nf">getNulledList</span><span class="o">()</span> <span class="o">{</span>
  <span class="nc">List</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>
  <span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
  <span class="k">return</span> <span class="n">list</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<h2 id="streams-to-the-rescue">Streams to the rescue?</h2>

<p>Let’s use Java Streams to implement the <code class="language-plaintext highlighter-rouge">buildWalks()</code> again.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Walk</span><span class="o">&gt;</span> <span class="nf">buildWalks</span><span class="o">(</span>
    <span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">names</span><span class="o">,</span>
    <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Cat</span><span class="o">&gt;&gt;</span> <span class="n">cats</span><span class="o">,</span>
    <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Dog</span><span class="o">&gt;&gt;</span> <span class="n">dogs</span><span class="o">,</span>
    <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Pig</span><span class="o">&gt;&gt;</span> <span class="n">pigs</span><span class="o">)</span> <span class="o">{</span>

  <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Walk</span><span class="o">&gt;</span> <span class="n">walks</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>

  <span class="n">names</span><span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="n">name</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">forEachAtLeastOnce</span><span class="o">(</span><span class="n">cats</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">name</span><span class="o">),</span> <span class="n">cat</span> <span class="o">-&gt;</span> <span class="o">{</span>
      <span class="n">forEachAtLeastOnce</span><span class="o">(</span><span class="n">dogs</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">name</span><span class="o">),</span> <span class="n">dog</span> <span class="o">-&gt;</span> <span class="o">{</span>
        <span class="n">forEachAtLeastOnce</span><span class="o">(</span><span class="n">pigs</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">name</span><span class="o">),</span> <span class="n">pig</span> <span class="o">-&gt;</span> <span class="o">{</span>
          <span class="n">walks</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="nc">Walk</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">cat</span><span class="o">,</span> <span class="n">dog</span><span class="o">,</span> <span class="n">pig</span><span class="o">));</span>
        <span class="o">});</span>
      <span class="o">});</span>
    <span class="o">});</span>
  <span class="o">});</span>

  <span class="k">return</span> <span class="n">walks</span><span class="o">;</span>
<span class="o">}</span>

<span class="kd">private</span> <span class="no">T</span> <span class="nf">forEachAtLeastOnce</span><span class="o">(</span><span class="nc">List</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">animals</span><span class="o">,</span> <span class="nc">Consumer</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">consumer</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">animals</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">animals</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
    <span class="n">consumer</span><span class="o">.</span><span class="na">accept</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="n">animals</span><span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="n">consumer</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p>If you look at the code, do you see at a glance what’s going on? Indee, I need some time to read through every single line to know what the method actually returns.</p>

<h2 id="conclusion">Conclusion</h2>

<p>The main difference of the implementations is the idea how the permuations will be created.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span><span class="o">(</span><span class="nc">String</span> <span class="n">person</span> <span class="o">:</span> <span class="n">people</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">for</span> <span class="o">(</span><span class="nc">Cat</span> <span class="n">cat</span> <span class="o">:</span> <span class="n">atLeastOnce</span><span class="o">(</span><span class="n">cats</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">person</span><span class="o">)))</span> <span class="o">{</span>
    <span class="k">for</span> <span class="o">(</span><span class="nc">Dog</span> <span class="n">dog</span> <span class="o">:</span> <span class="n">atLeastOnce</span><span class="o">(</span><span class="n">dogs</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">person</span><span class="o">)))</span> <span class="o">{</span>
      <span class="k">for</span> <span class="o">(</span><span class="nc">Pig</span> <span class="n">pig</span> <span class="o">:</span> <span class="n">atLeastOnce</span><span class="o">(</span><span class="n">pigs</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">person</span><span class="o">)))</span> <span class="o">{</span>
        <span class="n">walks</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="nc">Walk</span><span class="o">(</span><span class="n">person</span><span class="o">,</span> <span class="n">cat</span><span class="o">,</span> <span class="n">dog</span><span class="o">,</span> <span class="n">pig</span><span class="o">));</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">names</span><span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="n">name</span> <span class="o">-&gt;</span> <span class="o">{</span>
  <span class="n">forEachAtLeastOnce</span><span class="o">(</span><span class="n">cats</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">name</span><span class="o">),</span> <span class="n">cat</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">forEachAtLeastOnce</span><span class="o">(</span><span class="n">dogs</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">name</span><span class="o">),</span> <span class="n">dog</span> <span class="o">-&gt;</span> <span class="o">{</span>
      <span class="n">forEachAtLeastOnce</span><span class="o">(</span><span class="n">pigs</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">name</span><span class="o">),</span> <span class="n">pig</span> <span class="o">-&gt;</span> <span class="o">{</span>
        <span class="n">walks</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="nc">Walk</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">cat</span><span class="o">,</span> <span class="n">dog</span><span class="o">,</span> <span class="n">pig</span><span class="o">));</span>
      <span class="o">});</span>
    <span class="o">});</span>
  <span class="o">});</span>
<span class="o">});</span>
</code></pre></div></div>

<p>If you read the code, do you prefer nested for-loops or streams?</p>

<p>IMHO the nested for-loops can be understood more easily than streams. Therefore, I prefer the nested for-loops.</p>

<p>Please keep in mind, that Java Streams is a powerful performance improvement when you have to deal with large data sets. But you need to take special attention on readability if you don’t want to get a trade-off for your readers.</p>

        
      </section>

      <footer class="page__meta">
        
        


        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2021-03-25T22:03:03+00:00">March 25, 2021</time></p>


      </footer>

      

      
    </div>

    
  </article>

  
  
</div>

    </div>

    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    
      
        
          <li><a href="https://github.com/ThomasPr/ThomasPr.github.io" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
    

    
      <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2021 Thomas' Blog. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>










  </body>
</html>
